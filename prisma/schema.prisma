generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions", "fullTextSearch"]
  binaryTargets   = env("PRISMA_CLI_BINARY_TARGETS")
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  username     String        @unique
  firstName    String?
  lastName     String?
  password     String
  email        String?       @unique
  phoneNo      String?
  avatar       String
  status       UserStatus    @default(PENDING)
  reservations Reservation[]
  reviews      Review[]
  vendor       Vendor?
  admin        Admin?

  createdAt        DateTime          @default(now()) @map(name: "created_at")
  updatedAt        DateTime          @updatedAt @map(name: "updated_at")
  Cart             Cart[]
  Ledger           Ledger[]
  confirmationCode confirmationCode?

  @@map(name: "users")
}

model confirmationCode {
  id          String @id @default(uuid())
  user        User   @relation(fields: [username], references: [username])
  username    String @unique
  confirmCode String
}

enum UserStatus {
  PENDING
  ACTIVATE
  BANNED
  DEACTIVATE
}

model Vendor {
  id        String       @id @default(cuid())
  username  String       @unique
  userId    String       @unique
  certified Boolean      @default(false)
  status    VendorStatus @default(PENDING)
  desc      String
  user      User         @relation(fields: [userId], references: [id])
  products  Product[]
  category  Category[]   @default([Hospitality])

  createdAt   DateTime      @default(now()) @map(name: "created_at")
  updatedAt   DateTime      @updatedAt @map(name: "updated_at")
  Reservation Reservation[]
  Cart        Cart[]
}

enum VendorStatus {
  PENDING
  ACCEPTED
  BANNED
}

model Admin {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")
}

model Cart {
  username  String
  user      User    @relation(fields: [username], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  Vendor    Vendor? @relation(fields: [vendorId], references: [id])
  vendorId  String?

  @@id([username, productId])
}

model Ledger {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  path      String
  username  String
  user      User     @relation(fields: [username], references: [id])
  category  Category
}

model Reservation {
  id         String            @id @default(cuid())
  userId     String
  customer   User              @relation(fields: [userId], references: [id])
  vendorId   String
  vendor     Vendor            @relation(fields: [vendorId], references: [id])
  discountId String?
  discount   Discount?         @relation(fields: [discountId], references: [id])
  status     ReservationStatus @default(PENDING)
  total      Int

  createdAt         DateTime            @default(now()) @map(name: "created_at")
  updatedAt         DateTime            @updatedAt @map(name: "updated_at")
  ProuctReservation ProuctReservation[]
}

enum ReservationStatus {
  PENDING
  REJECTED
  ACCEPTED
}

model ProuctReservation {
  productId     String
  product       Product     @relation(fields: [productId], references: [id])
  reservationId String
  reservation   Reservation @relation(fields: [reservationId], references: [id])
  quantity      Int
  startAt       DateTime    @default(now())
  endAt         DateTime?

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")

  @@id([productId, reservationId])
}

model Product {
  id             String              @id @default(cuid())
  vendorUsername String
  category       Category            @default(Hospitality)
  vendor         Vendor              @relation(fields: [vendorUsername], references: [username])
  name           String
  images         String[]
  address        String
  price          Int                 @db.Integer
  desc           String              @db.Text
  reviews        Review[]
  avgReview      Float               @default(0)
  reservation    ProuctReservation[]

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")
  Cart      Cart[]
}

model Review {
  id        String  @id @default(uuid())
  userId    String
  user      User    @relation(fields: [userId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  rating    Int
  feedback  String  @db.Text

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")
}

model Discount {
  id          String        @id @default(cuid())
  name        String
  desc        String        @default("")
  amount      Int
  reservation Reservation[]

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @updatedAt @map(name: "updated_at")
}

enum Category {
  Healthcare
  Transportation
  Legal
  Financial
  Education
  Maintenance_N_repair
  F_N_B
  Retail
  Hospitality
}
